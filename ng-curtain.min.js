/**
 * ng-curtain - v0.0.1 - 2013-05-09
 * http://joshdmiller.github.io/ng-curtain
 *
 * Copyright (c) 2013 Josh David Miller
 * Licensed GPL <https://raw.github.com/joshdmiller/ng-curtain/master/LICENSE>
 */
(function(n,t){t.module("ngCurtain",[]).directive("ctnCurtains",["$window","$document","$location",function(n,e,i){return{restrict:"EA",transclude:!0,replace:!0,template:'<ul class="ctn-curtains" ng-transclude></ul>',scope:!0,controller:["$scope","$element",function(o){o.window=t.element(n);var r,c,l,s=o.sections=[],a=e.find("body");o.locationChangeFromScroll=!1,this.addSection=function(n){s.push(n)},this.setCurrent=o.setCurrent=function(n){l=n||0;var e=s[l];t.forEach(s,function(n){n.isCurrent=!1,n.isHidden=!0}),e.isCurrent=!0,e.isHidden=!1,i.path(e.path),s.length>l+1&&(s[l+1].isHidden=!1)},o.scrollTo=function(){var n=i.path();t.forEach(s,function(t,e){t.path===n&&(l=e)}),l=l||0,o.setCurrent(l),o.window[0].scroll(0,s[l].levelHeight),t.forEach(s,function(n,t){l>t&&n.translate(-n.height)})},o.configureSections=function(){var n,e=0;r=o.window.prop("innerHeight"),c=0,t.forEach(s,function(t,i){n=t.getHeight(),t.levelHeight=e,t.height=n,t.zIndex=999-i,t.setHeight(r),c+=parseInt(t.height,10),e+=parseInt(t.height,10)}),a.css("height",c+"px")},o.handleScroll=function(){var n=o.window.prop("pageYOffset"),t=s[l],e=t.levelHeight,i=t.height;e>n&&l>0?(t.translate(0),o.locationChangeFromScroll=!0,o.setCurrent(l-1)):e+i>n?t.translate(-(n-e)):(o.locationChangeFromScroll=!0,o.setCurrent(l+1))}}],link:function(n){n.configureSections(),n.scrollTo(),n.window.bind("resize",function(){n.$apply(n.configureSections)}),n.window.bind("scroll",function(){n.$apply(n.handleScroll)}),n.$on("$locationChangeSuccess",function(t){n.locationChangeFromScroll||n.scrollTo(t),n.locationChangeFromScroll=!1})}}}]).directive("ctnCurtain",function(){return{restrict:"EA",transclude:!0,replace:!0,template:'<li class="ctn-curtain" ng-class="{ current: isCurrent, cover: isCover, hidden: isHidden }" ng-transclude></li>',scope:!0,require:"^ctnCurtains",controller:["$scope","$element",function(n,t){n.setHeight=function(e){n.isCover||e>n.height?(n.height=e,t.css("height",n.height+"px")):t.css("min-height",n.height+"px"),t.css("z-index",n.zIndex)},n.translate=function(n){var e="translateY("+n+"px)";t.css({transform:e,"-webkit-transform":e,"-moz-transform":e})},n.getHeight=function(){return t.prop("offsetHeight")}}],link:function(n,t,e,i){i.addSection(n),n.isCover=n.$eval(e.ctnCover),n.path="/"+e.ctnCurtain}}})})(window,window.angular);